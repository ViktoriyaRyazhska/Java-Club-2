DROP DATABASE IF EXISTS library;

-- MySQL Script generated by MySQL Workbench
-- Чт 02 сен 2021 23:36:23
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema library
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema library
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `library` DEFAULT CHARACTER SET utf8 ;
USE `library` ;

-- -----------------------------------------------------
-- Table `library`.`autor`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `library`.`autor` (
                                              `idautor` INT NOT NULL,
                                              `firstName` VARCHAR(45) NOT NULL,
                                              `lastName` VARCHAR(45) NOT NULL,
                                              PRIMARY KEY (`idautor`))
    ENGINE = InnoDB
    DEFAULT CHARACTER SET = utf8mb3;


-- -----------------------------------------------------
-- Table `library`.`genre`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `library`.`genre` (
                                              `idgenre` INT NOT NULL,
                                              `title` VARCHAR(45) NOT NULL,
                                              PRIMARY KEY (`idgenre`),
                                              UNIQUE INDEX `title_UNIQUE` (`title` ASC) VISIBLE)
    ENGINE = InnoDB
    DEFAULT CHARACTER SET = utf8mb3;


-- -----------------------------------------------------
-- Table `library`.`book`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `library`.`book` (
                                             `idbook` INT NOT NULL,
                                             `title` VARCHAR(255) NULL DEFAULT NULL,
                                             `description` VARCHAR(255) NULL DEFAULT NULL,
                                             `is_deleted` TINYINT NULL DEFAULT NULL,
                                             `publicationDate` DATE NULL DEFAULT NULL,
                                             `CREATED_AT` TIMESTAMP NULL DEFAULT NULL,
                                             `UPDATATED_AT` TIMESTAMP NULL DEFAULT NULL,
                                             `genre_idgenre` INT NOT NULL,
                                             PRIMARY KEY (`idbook`),
                                             INDEX `fk_book_genre1_idx` (`genre_idgenre` ASC) VISIBLE,
                                             CONSTRAINT `fk_book_genre1`
                                                 FOREIGN KEY (`genre_idgenre`)
                                                     REFERENCES `library`.`genre` (`idgenre`))
    ENGINE = InnoDB
    DEFAULT CHARACTER SET = utf8mb3;


-- -----------------------------------------------------
-- Table `library`.`autor_has_book`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `library`.`autor_has_book` (
                                                       `autor_idautor` INT NOT NULL,
                                                       `book_idbook` INT NOT NULL,
                                                       `co_autor` TINYINT NULL DEFAULT NULL,
                                                       PRIMARY KEY (`autor_idautor`, `book_idbook`),
                                                       INDEX `fk_autor_has_book_book1_idx` (`book_idbook` ASC) VISIBLE,
                                                       INDEX `fk_autor_has_book_autor_idx` (`autor_idautor` ASC) VISIBLE,
                                                       CONSTRAINT `fk_autor_has_book_autor`
                                                           FOREIGN KEY (`autor_idautor`)
                                                               REFERENCES `library`.`autor` (`idautor`),
                                                       CONSTRAINT `fk_autor_has_book_book1`
                                                           FOREIGN KEY (`book_idbook`)
                                                               REFERENCES `library`.`book` (`idbook`))
    ENGINE = InnoDB
    DEFAULT CHARACTER SET = utf8mb3;


-- -----------------------------------------------------
-- Table `library`.`book_status`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `library`.`book_status` (
                                                    `idbook_status` INT NOT NULL,
                                                    `title` VARCHAR(45) NULL DEFAULT NULL,
                                                    PRIMARY KEY (`idbook_status`))
    ENGINE = InnoDB
    DEFAULT CHARACTER SET = utf8mb3;


-- -----------------------------------------------------
-- Table `library`.`book_copy`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `library`.`book_copy` (
                                                  `idbook_copy` INT NOT NULL,
                                                  `book_idbook` INT NOT NULL,
                                                  `book_status_idbook_status` INT NOT NULL,
                                                  `is_deleted` VARCHAR(45) NULL,
                                                  PRIMARY KEY (`idbook_copy`),
                                                  INDEX `fk_book_copy_book1_idx` (`book_idbook` ASC) VISIBLE,
                                                  INDEX `fk_book_copy_book_status1_idx` (`book_status_idbook_status` ASC) VISIBLE,
                                                  CONSTRAINT `fk_book_copy_book1`
                                                      FOREIGN KEY (`book_idbook`)
                                                          REFERENCES `library`.`book` (`idbook`),
                                                  CONSTRAINT `fk_book_copy_book_status1`
                                                      FOREIGN KEY (`book_status_idbook_status`)
                                                          REFERENCES `library`.`book_status` (`idbook_status`))
    ENGINE = InnoDB
    DEFAULT CHARACTER SET = utf8mb3;


-- -----------------------------------------------------
-- Table `library`.`order_status`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `library`.`order_status` (
                                                     `idorder_status` INT NOT NULL,
                                                     `title` VARCHAR(45) NULL,
                                                     PRIMARY KEY (`idorder_status`))
    ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `library`.`role`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `library`.`role` (
                                             `idrole` INT NOT NULL,
                                             `description` VARCHAR(45) NOT NULL,
                                             PRIMARY KEY (`idrole`),
                                             UNIQUE INDEX `description_UNIQUE` (`description` ASC) VISIBLE)
    ENGINE = InnoDB
    DEFAULT CHARACTER SET = utf8mb3;


-- -----------------------------------------------------
-- Table `library`.`user`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `library`.`user` (
                                             `idUser` INT NOT NULL,
                                             `firstName` VARCHAR(45) NULL DEFAULT NULL,
                                             `lastName` VARCHAR(45) NOT NULL,
                                             `email` VARCHAR(255) NOT NULL,
                                             `passwod` VARCHAR(255) NOT NULL,
                                             `birthdate` DATE NULL DEFAULT NULL,
                                             `CREATED_AT` TIMESTAMP NULL DEFAULT NULL,
                                             `UPDATE_AT` TIMESTAMP NULL DEFAULT NULL,
                                             `role_idrole` INT NOT NULL,
                                             `is_deleted` TINYINT NULL,
                                             PRIMARY KEY (`idUser`, `lastName`),
                                             UNIQUE INDEX `email_UNIQUE` (`email` ASC) VISIBLE,
                                             INDEX `fk_person_role1_idx` (`role_idrole` ASC) VISIBLE,
                                             CONSTRAINT `fk_person_role1`
                                                 FOREIGN KEY (`role_idrole`)
                                                     REFERENCES `library`.`role` (`idrole`))
    ENGINE = InnoDB
    DEFAULT CHARACTER SET = utf8mb3;


-- -----------------------------------------------------
-- Table `library`.`book_order`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `library`.`book_order` (
                                                   `idbookBorrow` INT NOT NULL,
                                                   `CREATED_AT` TIMESTAMP NULL DEFAULT NULL,
                                                   `UPDATATED_AT` TIMESTAMP NULL DEFAULT NULL,
                                                   `CLOSED_AT` TIMESTAMP NULL DEFAULT NULL,
                                                   `expected_return_time` DATE NULL DEFAULT NULL,
                                                   `book_copy_idbook_copy` INT NOT NULL,
                                                   `is_deleted` VARCHAR(45) NULL,
                                                   `order_status_idorder_status` INT NOT NULL,
                                                   `reader_take_at` DATE NULL,
                                                   `user_idUser` INT NOT NULL,
                                                   `user_lastName` VARCHAR(45) NOT NULL,
                                                   PRIMARY KEY (`idbookBorrow`),
                                                   INDEX `fk_bookBorrow_book_copy1_idx` (`book_copy_idbook_copy` ASC) VISIBLE,
                                                   INDEX `fk_book_order_order_status1_idx` (`order_status_idorder_status` ASC) VISIBLE,
                                                   INDEX `fk_book_order_user1_idx` (`user_idUser` ASC, `user_lastName` ASC) VISIBLE,
                                                   CONSTRAINT `fk_bookBorrow_book_copy1`
                                                       FOREIGN KEY (`book_copy_idbook_copy`)
                                                           REFERENCES `library`.`book_copy` (`idbook_copy`),
                                                   CONSTRAINT `fk_book_order_order_status1`
                                                       FOREIGN KEY (`order_status_idorder_status`)
                                                           REFERENCES `library`.`order_status` (`idorder_status`)
                                                           ON DELETE NO ACTION
                                                           ON UPDATE NO ACTION,
                                                   CONSTRAINT `fk_book_order_user1`
                                                       FOREIGN KEY (`user_idUser` , `user_lastName`)
                                                           REFERENCES `library`.`user` (`idUser` , `lastName`)
                                                           ON DELETE NO ACTION
                                                           ON UPDATE NO ACTION)
    ENGINE = InnoDB
    DEFAULT CHARACTER SET = utf8mb3;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
